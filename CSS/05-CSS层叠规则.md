# CSS层叠规则

层叠上下文和层叠规则。

## z-index

z-index属性只有和定位元素（position不为static）在一起的时候才有作用，可以是正数也可以是负数。

## 层叠上下文和层叠水平

- 层叠上下文

如果一个元素含有层叠上下文，我们可以理解为这个元素在z轴上就高人一等。

- 层叠水平

决定同一个层叠上下文中元素在z轴上的显示顺序。

所以计算层叠次序的时候，应该先比较层叠上下文，再比较层叠水平。

## 层叠顺序

![图来自张鑫旭学长](./stack-order.png)

图来自张鑫旭学长

## 深入了解层叠上下文

层叠上下文有如下特性：

- 其层叠水平比普通元素高；
- 其可以嵌套，内部层叠上下文机器所有子元素均受制于外部“层叠上下文”；
- 每个层叠上下文和兄弟独立；
- 每个层叠上下文自成体系，当元素发生折叠时，整个元素被认为是在父层叠上文的层叠顺序中。

层叠上下文包括三种：

1. 根层叠上下文
2. z-index为数值的定位元素的层叠上下文
3. 其他CSS3属性（flex布局元素，opacity，transform，filter，isolation，will-change属性等）

## 层叠上下文与层叠顺序

层叠上下文的级别如何计算？

1. 如果层叠上下文不依赖z-index数值，则其层叠顺序是z-index:auto，可以理解为z-index:0级别。
2. 如果层叠上下文依赖z-index数值，则其层叠顺序由z-index值决定。

根据这个理论，定位元素会层叠在普通元素上可以解释了。元素一旦成为定位元素，其z-index值会自动生效，此时其z-index就是默认的auto，也就是0级别，根据上面的层叠顺序表，就会覆盖inline或block或float元素。

---

参考：CSS世界

