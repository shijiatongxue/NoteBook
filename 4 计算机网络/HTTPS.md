# HTTPS

## SSL层

简而言之，HTTPS就是在HTTP下加入了SSL层，它有以下3个用途：

1. 通过证书信息确认网站的真实性；
2. 建立加密的信息通道；
3. 数据内容的完整性。

## 原理

SSL协议的基本思路是采用公钥加密算法，也就是说，客户端先向服务器端索要公钥，然后用公钥加密信息，服务器收到密文后，用自己的私钥解密。

但是，这里存在两个问题：

1. 如何保证公钥不被篡改？
2. 解决办法：将公钥放在数字证书中。

3. 公钥加密计算量太大，如何减少耗用时间？
4. 解决办法：每一对session，客户端和服务器都生成一个“对话秘钥”，用它来加密信息。由于“对话秘钥”是对称加密，所以运算速度很快，而服务器公钥只用于加密“对话秘钥”本身，这样就减少了加密运算的消耗时间。

## 握手阶段的详细过程

“握手阶段”涉及四次通信，所有通信都是明文的。

- 客户端发出请求：生成随机数（稍后用于生成对话密钥）
- 服务器响应：生成随机数
- 客户端回应：验证服务器证书，取出公钥，生成随机数（公钥加密），编码改变通知，发送内容Hash以供校验
- 服务器最后响应：编码改变通知，发送内容Hash以供校验

握手结束后，客户端与服务器进入加密通道后，就完全是普通的HTTP协议，只不过会用会话密钥加密内容。

## 总结

握手阶段主要是为了协商非对称加密算法以及生成对话密钥。

其中：

- 对话秘钥是对称算法，它对通信内容进行加密。
- 非对称加密算法只对会话秘钥进行加密。

所以整个SSL协议的核心在于通过四次握手把客户端加密的随机数（第3次握手）发送给服务器，然后HTTP消息用会话秘钥进行加密。

前两次握手核心在于传递公钥和完整性校验，后两次握手在于传递加密随机数和完整性校验。

---

参考：[阮一峰](http://www.ruanyifeng.com/blog/2014/02/ssl_tls.html)