# 一、关系型数据库设计范式

> 概念

范式：Normal Format，符合某一种级别的关系模式的集合，表示一个关系内部各属性之间的联系的合理化程度

- 范式是离散数学的概念
- 范式目标是在满足组织和存储的前提下使数据结构冗余最小化
- 范式级别越高，表的级别就越标准
- 目前数据库应用到的范式有以下几层
  - 第一范式
  - 第二范式
  - 第三范式
  - 逆规范化

## 1、第一范式 1NF

> 概念

第一范式：1NF，数据字段设计时必须满足原子性

- 1NF 要求字段数据是不需要拆分就可以直接使用
- 如果数据使用的时候需要进行拆分那么就违背 1NF

> 步骤

1. 设计的字段是在使用的时候还需要再拆分
2. 将数据拆分到最小单位，然后设计字段
3. 满足 1NF

> 小结

需要根据业务，对字段进行原子性划分

## 2、第二范式 2NF

> 概念

第二范式：2NF，字段设计不能存在部分依赖

- 部分依赖：首先表中存在复合主键，其次有的字段不是依赖整个主键，而是依赖主键的一部分
- 部分依赖解决：让所有非主属性都依赖一个候选关键字
  - 最简单方式：取消复合主键（一般使用逻辑主键代替，但是本质一来是复合主键做主），所有非主属性都依赖主属性（逻辑主键）
  - 正确方式：将部分依赖关系独立成表

> 步骤

1. 表中是否存在复合主键？
2. 其他字段是否存在依赖主键中的一部分？
3. 如果存在部分依赖，将部分依赖的关系独立拆分成表
4. 满足 2NF

> 示例

**问题：**学生成绩表中学生和课程应该是决定性关系，因此属性主属性。

- 成绩是由学生和课程决定的，是完全依赖主属性
- 性别只依赖学生（部分依赖）
- 教室、开始时间和结束时间依赖课程（部分依赖）

**解决方案**：将学生信息维护到一张表，将课程信息维护到一张表

> 小结

1. 2NF 是在满足 1NF 的前提之上的
2. 2NF 的目标是消除部分依赖
3. 2NF 可以消除很大程度的数据冗余

## 3、第三范式 3NF

> 概念

第三范式：3NF，字段设计不能存在传递依赖

- 传递依赖：字段某个非主属性不直接依赖主属性，而是通过依赖某个其他非主属性而传递到主属性之上
- 传递依赖解决：让依赖非主属性的字段与依赖字段独立成表

## 4、逆规范化

> 概念

逆规范化：为了**提升数据查询效率**而**刻意违背范式的规则**

- 所谓逆规范化就是减少表之间的关联查询（效率降低），刻意增加数据冗余

> 步骤

1. 表中部分数据来源于其他表
2. 当前表会被高频次查询
3. 数据表数据量大
4. 考虑使用逆规范化

> 小结

1. 逆规范化只有在数据量大，查询效率低下的时候为了提升效率而牺牲磁盘空间的一种做法
2. 逆规范化后的数据表的设计必然是不符合范式要求的（2NF/3NF）

# 二、表关系

> 概念

表关系：一个表代表一个实体，实体之间都是有关联关系的

- 根据范式的要求来设计表关系，减少数据冗余
- 根据实际需求来设计表关系，提升访问效率

> 示例

设计一个简单新闻管理系统的数据库

- 新闻信息表：id、标题、内容、发布时间、作者id、分类id、阅读量、推荐数
- 作者表：id、作者名字、作者来源id
- 来源表：id、来源名字、来源描述
- 分类表：id、分类名字、分类级别
- 评论表：id、评论id、评论时间、评论内容（不回复）

## 1、一对一

> 概念

一对一关系：一张表中的一条记录与另外一张表中有且仅有一条有关系

- 一对一关系通常是用来将一张原本就是一体的表拆分成两张表
  - 频繁使用部分：常用字段
  - 不常用部分：生僻字段
  - 使用相同的主键对应
- **一对一关系设计较多使用在优化方面**

> 步骤

1. 一张表的数据字段较多数据量较大
2. 表中有部分字段使用频次较高，而另一部分较少使用
3. 将常用字段和不常用字段拆分成两张表，使用相同的主键对应

## 2、一对多

> 概念

一对多关系：也叫多对一关系，一张表的一条记录与另外一张表的多条记录对应

- 一对多关系是实体中非常常见的一种关系，实体设计时也应用非常多
- **一对多的核心解决方案是如何让记录能够正确匹配到另外表中的数据**
  - 一表设计：一表记录在另外一张表中有多条记录，所以无法记录多个字段（违背 1NF）
  - 多表设计：多表记录在另外一张表中只有一条记录，可以设置字段记录对应的主属性（通常主键）

> 步骤

1. 确定实体间的关系为一对多关系
2. 在多表中增加一个字段记录一表中对应的主属性

## 3、多对多

> 概念

多对多关系：一张表中的一条记录对应另外一张表中的多条记录，反过来一样

- 多对多关系在实体中是最常见的关系
- 多对多关系是无法在自身表中维护对应表关系的（违背 1NF），**需要通过第三方表实现将多对多关系变成多个多对一关系**
  - 设计一个中间表：记录两张表之间的对应关系（主属性）
  - 中间表与其他表都是多对一关系

> 步骤

1. 确定实体间的关系为多对多关系
2. 设计中间表，记录两张表的对应关系

