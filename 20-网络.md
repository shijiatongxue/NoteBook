# 浏览器生成消息

- 生成HTTP请求消息
  - 浏览器如何解析网址
  - 请求消息长什么样？
- 向DNS服务器查询Web服务器的IP地址
  - 浏览器查询服务器的IP
- DNS服务器
  - DNS服务器之间的协作
- 委托协议栈发送消息
  - 委托操作系统发送消息

## 生成HTTP请求消息

### URL
包含协议类型、域名和文件路径等。

### 浏览器如何要解析URL?
根据URL得到协议类型、域名、端口号、路径名等。

### 省略文件名的情况
- https://www.github.com/dir/

一般我们在访问网站的时候不会输入文件名，这时浏览器会根据服务器事先配置好的默认访问文件名，大多数情况下是index.html或default.htm之类的。

- https://www.github.com/
  
有时还会出现访问根目录，情况与上面类似。

- https://www.github.com

当把根目录都省略时，就代表访问根目录下事先设置的默认文件。

- https://www.github.com/what

对于这种末尾没有'/'，一般不推荐使用。服务器会查询有没有这个文件，如果没有这个文件，则把它当作文件夹名处理。

### HTTP的基本思路
解析完URL，浏览器会使用HTTP协议来访问Web服务器。

HTTP请求包括两部分，“对什么”和“进行怎样操作”。

“对什么”：要访问的URI。

“进行什么操作”：

- **GET**：获取URI指定的信息。
- **POST**：从客户端向服务器发送数据。一般是表单。
- HEAD：和GET基本相同，区别在于只返回请求头。
- PUT：替换URI指定的服务器上的文件。或新建文件。
- DELETE：删除文件。
- TRACE：将服务器收到的请求行和头部直接返回给客户端。用于在使用代理的环境中检查改写请求的情况。
- CONNECT：使用代理传输加密消息时使用的方法。
- OPTIONS：用于通知或查询通信选项。

收到请求消息后，Web服务器会对其中的内容进行解析，通过URI和方法来判断“对什么”“进行怎样的操作”，并根据这些要求完成自己的工作，然后将结果放在相应消息中。

响应消息会被发送回客户端，客户端收到之后，浏览器会从消息中读出所需的数据并显示在屏幕上。到这里，HTTP的整个工作就完成了。

### 生成HTTP请求消息
首先，请求消息的第一行称为请求行。

**GET /dir/index.html HTTP/1.1**

第二行开始为消息头。

通用头：适用于请求和响应消息的头字段。
- Date
- Prag
- Cache-Control：控制缓存的相关信息
- Connection
- Transfer-Enconding
- Via

请求头：用于表示请求消息的附加信息的头字段
- Authorization：身份认证数据
- From：请求发送者的邮件地址
- If-Modified-Since：用于判断客户端缓存数据是否过期
- Referer
- User-Agent
- Accept-Charset
- Accept-Encoding
- Accept-Language
- Host：接收请求的服务器IP和端口号
- If-Match
- If-None-Match
- If-Unmodified-Since：在指定日期之后数据未更新时执行请求
- Range：当需要只获取部分数据而不是全部数据时，可通过这个字段指定要获取的数据范围

响应头：用于表示响应消息的附加信息的头字段
- Location：当前请求URI的据对路径
- Server：服务器程序的名称和版本号等相关信息。
- WWW-Authenticate
- Accept-Ranges：当希望仅请求部分数据时，服务器会告知客户端是否支持这一功能。

实体头：用于表示实体（消息体）的附加信息的头字段
- Allow：表示指定的URI支持的方法
- Content-Encoding
- Content-Length
- Content-Type：表示消息体的数据类型，以MIME规格定义的数据类型表示
- Expires：表示消息体的有效期
- Last-Modified：数据的最后更新日期
- Content-Language：表示消息体的语言。
- Content-Location：表示消息体在服务器上的URI。
- Content-Range：当仅请求部分数据时，表示消息体包含的数据范围
- Etag：在更新操作时，有时候需要基于上一次请求的响应数据来发送一下次请求，在这种情况下，这个字段可以用来提供上次响应与下次请求之间的关联信息。

当用POST方法时，需要将表单中填写的信息写在消息体中。