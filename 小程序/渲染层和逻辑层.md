# 1 通信模型

小程序的渲染层和逻辑层分别由两个线程控制：渲染层的界面使用了WebView进行渲染；逻辑层采用JSCore线程运行JS脚本。一个小程序存在多个界面，所以渲染层存在多个WebView线程，这两个线程的通信经由微信客户端做中转，逻辑层发送网络网络请求也经由Native转发。

![渲染层和逻辑层通信模型](..\图示\渲染层和逻辑层通信模型.png)

# 2 双线程下的页面渲染

小程序的逻辑层和渲染层是分开的两个线程。在渲染层，宿主环境会把WXML转化成对应的JS对象，在逻辑层发生数据变更的时候，我们需要通络宿主环境提供的setData方法吧数据从逻辑层传递到渲染层，再经过对比前后差异，把差异引用在原来的DOM树上，渲染出正确的UI界面。

![逻辑层传递数据到渲染层](..\图示\逻辑层传递数据到渲染层.png)

